# üìä Êï∞ÊçÆÂ∫ì‰ºòÂåñÂª∫ËÆÆÊñáÊ°£

## Ê¶ÇËø∞

Âü∫‰∫éÊï∞Â≠óÈí±ÂåÖÁÆ°ÁêÜÂêéÂè∞ÁöÑ‰∏öÂä°ÈúÄÊ±ÇÂàÜÊûêÔºåÊú¨ÊñáÊ°£ÊèêÂá∫‰∫ÜÂÖ®Èù¢ÁöÑÊï∞ÊçÆÂ∫ì‰ºòÂåñÊñπÊ°àÔºåÂåÖÊã¨Ë°®ÁªìÊûÑ‰ºòÂåñ„ÄÅÁ¥¢ÂºïÁ≠ñÁï•„ÄÅÊü•ËØ¢‰ºòÂåñ„ÄÅÊÄßËÉΩË∞É‰ºòÂíåÊâ©Â±ïÊÄßËÆæËÆ°ÔºåÁ°Æ‰øùÁÆ°ÁêÜÂêéÂè∞Á≥ªÁªüËÉΩÂ§üÈ´òÊïàÂ§ÑÁêÜÂ§ßÈáèÊï∞ÊçÆÊü•ËØ¢ÂíåÂàÜÊûêÈúÄÊ±Ç„ÄÇ

## ÂΩìÂâçÊï∞ÊçÆÂ∫ìÊû∂ÊûÑÂàÜÊûê

### 1. Áé∞ÊúâË°®ÁªìÊûÑËØÑ‰º∞

#### Ê†∏ÂøÉ‰∏öÂä°Ë°®
```sql
-- Áî®Êà∑Ë°® (users)
-- ‰ºòÂåñÂâçÈóÆÈ¢òÔºöÁº∫Â∞ëÂ§çÂêàÁ¥¢ÂºïÔºåÁä∂ÊÄÅÊü•ËØ¢ÊïàÁéá‰Ωé
CREATE TABLE users (
  id INT PRIMARY KEY AUTO_INCREMENT,
  username VARCHAR(50) UNIQUE,
  email VARCHAR(100) UNIQUE,
  phone VARCHAR(20),
  status ENUM('active', 'inactive', 'frozen'),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Èí±ÂåÖË°® (wallets)
-- ‰ºòÂåñÂâçÈóÆÈ¢òÔºö‰ΩôÈ¢ùÊü•ËØ¢ÂíåÁî®Êà∑ÂÖ≥ËÅîÊü•ËØ¢ÊÄßËÉΩÂ∑Æ
CREATE TABLE wallets (
  id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT,
  address VARCHAR(100),
  balance DECIMAL(20,8),
  frozen_balance DECIMAL(20,8),
  network VARCHAR(20),
  currency VARCHAR(10),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ‰∫§ÊòìË°® (transactions)
-- ‰ºòÂåñÂâçÈóÆÈ¢òÔºöÊó∂Èó¥ËåÉÂõ¥Êü•ËØ¢ÊÖ¢ÔºåÁä∂ÊÄÅÁ≠õÈÄâÊïàÁéá‰Ωé
CREATE TABLE transactions (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id INT,
  wallet_id INT,
  type ENUM('deposit', 'withdraw'),
  amount DECIMAL(20,8),
  status ENUM('pending', 'confirmed', 'failed'),
  tx_hash VARCHAR(100),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 2. ÊÄßËÉΩÁì∂È¢àËØÜÂà´

#### Êü•ËØ¢ÊÄßËÉΩÈóÆÈ¢ò
```javascript
/**
 * ÂΩìÂâçÁ≥ªÁªü‰∏≠ÁöÑÊÄßËÉΩÁì∂È¢àÊü•ËØ¢
 */
const PERFORMANCE_BOTTLENECKS = {
  // 1. Áî®Êà∑ÂàóË°®Êü•ËØ¢ - Áº∫Â∞ëÂ§çÂêàÁ¥¢Âºï
  userList: `
    SELECT u.*, w.balance 
    FROM users u 
    LEFT JOIN wallets w ON u.id = w.user_id 
    WHERE u.status = 'active' 
    AND u.created_at BETWEEN '2024-01-01' AND '2024-12-31'
    ORDER BY u.created_at DESC 
    LIMIT 20 OFFSET 0
  `,
  
  // 2. ‰∫§ÊòìÁªüËÆ°Êü•ËØ¢ - ÂÖ®Ë°®Êâ´Êèè
  transactionStats: `
    SELECT 
      DATE(created_at) as date,
      COUNT(*) as count,
      SUM(amount) as total_amount
    FROM transactions 
    WHERE created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
    GROUP BY DATE(created_at)
  `,
  
  // 3. Áî®Êà∑ËµÑ‰∫ßÊ±áÊÄª - Â§öË°®ÂÖ≥ËÅîÊïàÁéá‰Ωé
  userAssetSummary: `
    SELECT 
      u.id, u.username,
      SUM(w.balance) as total_balance,
      COUNT(t.id) as transaction_count
    FROM users u
    LEFT JOIN wallets w ON u.id = w.user_id
    LEFT JOIN transactions t ON u.id = t.user_id
    WHERE u.status = 'active'
    GROUP BY u.id
  `,
  
  // 4. ÂÆûÊó∂ÁõëÊéßÊü•ËØ¢ - È¢ëÁπÅÊü•ËØ¢ÂØºËá¥ÊÄßËÉΩÈóÆÈ¢ò
  realTimeMonitoring: `
    SELECT COUNT(*) as active_users 
    FROM users 
    WHERE last_login_at > DATE_SUB(NOW(), INTERVAL 5 MINUTE)
  `
};
```

## Êï∞ÊçÆÂ∫ìÁªìÊûÑ‰ºòÂåñÊñπÊ°à

### 1. Ë°®ÁªìÊûÑÈáçÊûÑ

#### Áî®Êà∑Ë°®‰ºòÂåñ
```sql
-- ‰ºòÂåñÂêéÁöÑÁî®Êà∑Ë°®
CREATE TABLE users (
  id INT PRIMARY KEY AUTO_INCREMENT,
  username VARCHAR(50) NOT NULL,
  email VARCHAR(100) NOT NULL,
  phone VARCHAR(20),
  real_name VARCHAR(50),
  id_card VARCHAR(18),
  status ENUM('active', 'inactive', 'frozen', 'deleted') DEFAULT 'active',
  level TINYINT DEFAULT 1 COMMENT 'Áî®Êà∑Á≠âÁ∫ß',
  last_login_at TIMESTAMP NULL,
  last_login_ip VARCHAR(45),
  login_count INT DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at TIMESTAMP NULL COMMENT 'ËΩØÂà†Èô§Êó∂Èó¥',
  
  -- Á¥¢Âºï‰ºòÂåñ
  UNIQUE KEY uk_username (username),
  UNIQUE KEY uk_email (email),
  INDEX idx_phone (phone),
  INDEX idx_status_created (status, created_at),
  INDEX idx_last_login (last_login_at),
  INDEX idx_level_status (level, status),
  INDEX idx_deleted_at (deleted_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

#### Èí±ÂåÖË°®‰ºòÂåñ
```sql
-- ‰ºòÂåñÂêéÁöÑÈí±ÂåÖË°®
CREATE TABLE wallets (
  id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT NOT NULL,
  address VARCHAR(100) NOT NULL,
  balance DECIMAL(20,8) DEFAULT 0.00000000,
  frozen_balance DECIMAL(20,8) DEFAULT 0.00000000,
  available_balance DECIMAL(20,8) GENERATED ALWAYS AS (balance - frozen_balance) STORED,
  network VARCHAR(20) NOT NULL DEFAULT 'TRON',
  currency VARCHAR(10) NOT NULL DEFAULT 'USDT',
  type ENUM('main', 'deposit') DEFAULT 'deposit',
  status ENUM('active', 'inactive', 'frozen') DEFAULT 'active',
  last_transaction_at TIMESTAMP NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  -- Á¥¢Âºï‰ºòÂåñ
  UNIQUE KEY uk_address (address),
  INDEX idx_user_id (user_id),
  INDEX idx_user_currency (user_id, currency),
  INDEX idx_balance (balance),
  INDEX idx_status_type (status, type),
  INDEX idx_last_transaction (last_transaction_at),
  INDEX idx_network_currency (network, currency),
  
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

#### ‰∫§ÊòìË°®‰ºòÂåñÔºàÂàÜÂå∫Ë°®Ôºâ
```sql
-- ‰ºòÂåñÂêéÁöÑ‰∫§ÊòìË°®ÔºàÊåâÊúàÂàÜÂå∫Ôºâ
CREATE TABLE transactions (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id INT NOT NULL,
  wallet_id INT NOT NULL,
  type ENUM('deposit', 'withdraw', 'transfer') NOT NULL,
  amount DECIMAL(20,8) NOT NULL,
  fee DECIMAL(20,8) DEFAULT 0.00000000,
  status ENUM('pending', 'processing', 'confirmed', 'failed', 'cancelled') NOT NULL,
  tx_hash VARCHAR(100),
  block_number BIGINT,
  confirmations INT DEFAULT 0,
  from_address VARCHAR(100),
  to_address VARCHAR(100),
  network VARCHAR(20) NOT NULL DEFAULT 'TRON',
  currency VARCHAR(10) NOT NULL DEFAULT 'USDT',
  remark TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  confirmed_at TIMESTAMP NULL,
  
  -- Á¥¢Âºï‰ºòÂåñ
  INDEX idx_user_id (user_id),
  INDEX idx_wallet_id (wallet_id),
  INDEX idx_tx_hash (tx_hash),
  INDEX idx_status_type (status, type),
  INDEX idx_created_at (created_at),
  INDEX idx_user_created (user_id, created_at),
  INDEX idx_status_created (status, created_at),
  INDEX idx_type_amount (type, amount),
  INDEX idx_network_currency (network, currency),
  
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (wallet_id) REFERENCES wallets(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
PARTITION BY RANGE (YEAR(created_at) * 100 + MONTH(created_at)) (
  PARTITION p202401 VALUES LESS THAN (202402),
  PARTITION p202402 VALUES LESS THAN (202403),
  PARTITION p202403 VALUES LESS THAN (202404),
  PARTITION p202404 VALUES LESS THAN (202405),
  PARTITION p202405 VALUES LESS THAN (202406),
  PARTITION p202406 VALUES LESS THAN (202407),
  PARTITION p202407 VALUES LESS THAN (202408),
  PARTITION p202408 VALUES LESS THAN (202409),
  PARTITION p202409 VALUES LESS THAN (202410),
  PARTITION p202410 VALUES LESS THAN (202411),
  PARTITION p202411 VALUES LESS THAN (202412),
  PARTITION p202412 VALUES LESS THAN (202501),
  PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

### 2. Êñ∞Â¢ûÁÆ°ÁêÜÂêéÂè∞‰∏ìÁî®Ë°®

#### ÁÆ°ÁêÜÂëòÊìç‰ΩúÊó•ÂøóË°®
```sql
CREATE TABLE admin_operation_logs (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  admin_id INT NOT NULL,
  admin_username VARCHAR(50) NOT NULL,
  operation_type VARCHAR(50) NOT NULL,
  resource_type VARCHAR(50) NOT NULL,
  resource_id VARCHAR(100),
  operation_desc TEXT,
  request_data JSON,
  response_data JSON,
  ip_address VARCHAR(45),
  user_agent TEXT,
  execution_time INT COMMENT 'ÊâßË°åÊó∂Èó¥(ÊØ´Áßí)',
  status ENUM('success', 'failed') NOT NULL,
  error_message TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  -- Á¥¢Âºï‰ºòÂåñ
  INDEX idx_admin_id (admin_id),
  INDEX idx_operation_type (operation_type),
  INDEX idx_resource_type (resource_type),
  INDEX idx_created_at (created_at),
  INDEX idx_admin_created (admin_id, created_at),
  INDEX idx_status_created (status, created_at),
  INDEX idx_ip_address (ip_address)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
PARTITION BY RANGE (YEAR(created_at) * 100 + MONTH(created_at)) (
  PARTITION p202401 VALUES LESS THAN (202402),
  PARTITION p202402 VALUES LESS THAN (202403),
  -- ... ÂÖ∂‰ªñÂàÜÂå∫
  PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

#### Êï∞ÊçÆÁªüËÆ°ÁºìÂ≠òË°®
```sql
CREATE TABLE data_statistics_cache (
  id INT PRIMARY KEY AUTO_INCREMENT,
  stat_key VARCHAR(100) NOT NULL,
  stat_date DATE NOT NULL,
  stat_hour TINYINT DEFAULT NULL COMMENT 'Â∞èÊó∂ÁªüËÆ°(0-23)',
  stat_value JSON NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  expires_at TIMESTAMP NOT NULL,
  
  -- Á¥¢Âºï‰ºòÂåñ
  UNIQUE KEY uk_key_date_hour (stat_key, stat_date, stat_hour),
  INDEX idx_stat_key (stat_key),
  INDEX idx_stat_date (stat_date),
  INDEX idx_expires_at (expires_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 3. Êï∞ÊçÆÂΩíÊ°£Á≠ñÁï•

#### ÂéÜÂè≤Êï∞ÊçÆÂΩíÊ°£Ë°®
```sql
-- ‰∫§ÊòìÂéÜÂè≤ÂΩíÊ°£Ë°®
CREATE TABLE transactions_archive (
  id BIGINT PRIMARY KEY,
  user_id INT NOT NULL,
  wallet_id INT NOT NULL,
  type ENUM('deposit', 'withdraw', 'transfer') NOT NULL,
  amount DECIMAL(20,8) NOT NULL,
  fee DECIMAL(20,8) DEFAULT 0.00000000,
  status ENUM('pending', 'processing', 'confirmed', 'failed', 'cancelled') NOT NULL,
  tx_hash VARCHAR(100),
  block_number BIGINT,
  confirmations INT DEFAULT 0,
  from_address VARCHAR(100),
  to_address VARCHAR(100),
  network VARCHAR(20) NOT NULL DEFAULT 'TRON',
  currency VARCHAR(10) NOT NULL DEFAULT 'USDT',
  remark TEXT,
  created_at TIMESTAMP,
  updated_at TIMESTAMP,
  confirmed_at TIMESTAMP NULL,
  archived_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  -- ÂΩíÊ°£Ë°®Á¥¢ÂºïÔºàËæÉÂ∞ëÔºâ
  INDEX idx_user_id (user_id),
  INDEX idx_created_at (created_at),
  INDEX idx_archived_at (archived_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## Á¥¢Âºï‰ºòÂåñÁ≠ñÁï•

### 1. Â§çÂêàÁ¥¢ÂºïËÆæËÆ°

#### Áî®Êà∑Áõ∏ÂÖ≥Êü•ËØ¢‰ºòÂåñ
```sql
-- Áî®Êà∑ÂàóË°®Êü•ËØ¢‰ºòÂåñ
-- Êü•ËØ¢ÔºöÊåâÁä∂ÊÄÅÂíåÂàõÂª∫Êó∂Èó¥Á≠õÈÄâÁî®Êà∑
ALTER TABLE users ADD INDEX idx_status_created_id (status, created_at, id);

-- Áî®Êà∑ÊêúÁ¥¢‰ºòÂåñ
-- Êü•ËØ¢ÔºöÊåâÁî®Êà∑Âêç„ÄÅÈÇÆÁÆ±„ÄÅÊâãÊú∫Âè∑ÊêúÁ¥¢
ALTER TABLE users ADD INDEX idx_search_fields (username, email, phone);

-- Ê¥ªË∑ÉÁî®Êà∑Êü•ËØ¢‰ºòÂåñ
-- Êü•ËØ¢ÔºöÊúÄËøëÁôªÂΩïÁöÑÊ¥ªË∑ÉÁî®Êà∑
ALTER TABLE users ADD INDEX idx_active_users (status, last_login_at, id);
```

#### ‰∫§ÊòìÁõ∏ÂÖ≥Êü•ËØ¢‰ºòÂåñ
```sql
-- Áî®Êà∑‰∫§ÊòìÂéÜÂè≤Êü•ËØ¢
-- Êü•ËØ¢ÔºöÁâπÂÆöÁî®Êà∑ÁöÑ‰∫§ÊòìËÆ∞ÂΩïÔºåÊåâÊó∂Èó¥ÊéíÂ∫è
ALTER TABLE transactions ADD INDEX idx_user_time_status (user_id, created_at, status);

-- ‰∫§ÊòìÁä∂ÊÄÅÁªüËÆ°Êü•ËØ¢
-- Êü•ËØ¢ÔºöÊåâÁä∂ÊÄÅÂíåÊó∂Èó¥ÁªüËÆ°‰∫§Êòì
ALTER TABLE transactions ADD INDEX idx_status_time_amount (status, created_at, amount);

-- Â§ßÈ¢ù‰∫§ÊòìÁõëÊéß
-- Êü•ËØ¢ÔºöÈáëÈ¢ùË∂ÖËøáÈòàÂÄºÁöÑ‰∫§Êòì
ALTER TABLE transactions ADD INDEX idx_amount_created (amount, created_at);

-- ‰∫§ÊòìÂìàÂ∏åÊü•ËØ¢
-- Êü•ËØ¢ÔºöÊ†πÊçÆ‰∫§ÊòìÂìàÂ∏åÊü•Êâæ‰∫§Êòì
ALTER TABLE transactions ADD INDEX idx_tx_hash_status (tx_hash, status);
```

#### Èí±ÂåÖÁõ∏ÂÖ≥Êü•ËØ¢‰ºòÂåñ
```sql
-- Áî®Êà∑Èí±ÂåÖÊ±áÊÄªÊü•ËØ¢
-- Êü•ËØ¢ÔºöÁî®Êà∑ÁöÑÊâÄÊúâÈí±ÂåÖÂèä‰ΩôÈ¢ù
ALTER TABLE wallets ADD INDEX idx_user_currency_balance (user_id, currency, balance);

-- Âú∞ÂùÄ‰ΩôÈ¢ùÊü•ËØ¢
-- Êü•ËØ¢ÔºöÁâπÂÆöÂú∞ÂùÄÁöÑÈí±ÂåÖ‰ø°ÊÅØ
ALTER TABLE wallets ADD INDEX idx_address_status (address, status);

-- Â§ßÈ¢ùÈí±ÂåÖÁõëÊéß
-- Êü•ËØ¢Ôºö‰ΩôÈ¢ùË∂ÖËøáÈòàÂÄºÁöÑÈí±ÂåÖ
ALTER TABLE wallets ADD INDEX idx_balance_status (balance, status);
```

### 2. Á¥¢Âºï‰ΩøÁî®ÁõëÊéß

#### Á¥¢ÂºïÊïàÊûúÂàÜÊûê
```sql
-- ÂàõÂª∫Á¥¢Âºï‰ΩøÁî®ÊÉÖÂÜµÁõëÊéßËßÜÂõæ
CREATE VIEW index_usage_stats AS
SELECT 
  t.TABLE_SCHEMA,
  t.TABLE_NAME,
  t.INDEX_NAME,
  s.ROWS_READ,
  s.ROWS_EXAMINED,
  s.ROWS_EXAMINED / s.ROWS_READ as efficiency_ratio
FROM information_schema.STATISTICS t
LEFT JOIN performance_schema.table_io_waits_summary_by_index_usage s
  ON t.TABLE_SCHEMA = s.OBJECT_SCHEMA 
  AND t.TABLE_NAME = s.OBJECT_NAME 
  AND t.INDEX_NAME = s.INDEX_NAME
WHERE t.TABLE_SCHEMA = 'wallet_db'
ORDER BY s.ROWS_EXAMINED DESC;
```

#### ÊÖ¢Êü•ËØ¢‰ºòÂåñÁõëÊéß
```javascript
/**
 * ÊÖ¢Êü•ËØ¢ÁõëÊéßÂíå‰ºòÂåñÂª∫ËÆÆ
 */
class SlowQueryOptimizer {
  /**
   * ÂàÜÊûêÊÖ¢Êü•ËØ¢Êó•Âøó
   */
  async analyzeSlowQueries() {
    const slowQueries = await this.getSlowQueries();
    const optimizations = [];
    
    for (const query of slowQueries) {
      const analysis = await this.analyzeQuery(query);
      
      if (analysis.missingIndexes.length > 0) {
        optimizations.push({
          query: query.sql,
          issue: 'missing_indexes',
          suggestion: `Âª∫ËÆÆÊ∑ªÂä†Á¥¢Âºï: ${analysis.missingIndexes.join(', ')}`,
          priority: 'high'
        });
      }
      
      if (analysis.fullTableScan) {
        optimizations.push({
          query: query.sql,
          issue: 'full_table_scan',
          suggestion: 'Êü•ËØ¢ÂØºËá¥ÂÖ®Ë°®Êâ´ÊèèÔºåÈúÄË¶Å‰ºòÂåñWHEREÊù°‰ª∂ÊàñÊ∑ªÂä†Á¥¢Âºï',
          priority: 'critical'
        });
      }
      
      if (analysis.inefficientJoins.length > 0) {
        optimizations.push({
          query: query.sql,
          issue: 'inefficient_joins',
          suggestion: `‰ºòÂåñË°®ËøûÊé•: ${analysis.inefficientJoins.join(', ')}`,
          priority: 'medium'
        });
      }
    }
    
    return optimizations;
  }
  
  /**
   * Ëá™Âä®ÁîüÊàêÁ¥¢ÂºïÂª∫ËÆÆ
   */
  async generateIndexSuggestions() {
    const suggestions = [];
    
    // ÂàÜÊûêÊü•ËØ¢Ê®°Âºè
    const queryPatterns = await this.analyzeQueryPatterns();
    
    for (const pattern of queryPatterns) {
      if (pattern.frequency > 100 && pattern.avgExecutionTime > 1000) {
        const indexSuggestion = this.generateIndexForPattern(pattern);
        suggestions.push(indexSuggestion);
      }
    }
    
    return suggestions;
  }
}
```

## Êü•ËØ¢‰ºòÂåñÊñπÊ°à

### 1. Â∏∏Áî®Êü•ËØ¢‰ºòÂåñ

#### Áî®Êà∑ÁÆ°ÁêÜÊü•ËØ¢‰ºòÂåñ
```sql
-- ‰ºòÂåñÂâçÔºöÁî®Êà∑ÂàóË°®Êü•ËØ¢
SELECT u.*, w.balance 
FROM users u 
LEFT JOIN wallets w ON u.id = w.user_id 
WHERE u.status = 'active' 
ORDER BY u.created_at DESC 
LIMIT 20 OFFSET 0;

-- ‰ºòÂåñÂêéÔºö‰ΩøÁî®Â§çÂêàÁ¥¢ÂºïÂíåÂ≠êÊü•ËØ¢
SELECT 
  u.id, u.username, u.email, u.status, u.created_at,
  COALESCE(wb.total_balance, 0) as total_balance
FROM users u
LEFT JOIN (
  SELECT user_id, SUM(balance) as total_balance
  FROM wallets 
  WHERE status = 'active'
  GROUP BY user_id
) wb ON u.id = wb.user_id
WHERE u.status = 'active'
ORDER BY u.created_at DESC
LIMIT 20;

-- Ê∑ªÂä†ÂØπÂ∫îÁ¥¢Âºï
CREATE INDEX idx_users_status_created ON users(status, created_at);
CREATE INDEX idx_wallets_status_user ON wallets(status, user_id);
```

#### ‰∫§ÊòìÁªüËÆ°Êü•ËØ¢‰ºòÂåñ
```sql
-- ‰ºòÂåñÂâçÔºöÂÆûÊó∂ÁªüËÆ°Êü•ËØ¢
SELECT 
  DATE(created_at) as date,
  COUNT(*) as count,
  SUM(amount) as total_amount
FROM transactions 
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY DATE(created_at);

-- ‰ºòÂåñÂêéÔºö‰ΩøÁî®ÁªüËÆ°ÁºìÂ≠òË°®
-- 1. ÂàõÂª∫ÊØèÊó•ÁªüËÆ°‰ªªÂä°
INSERT INTO data_statistics_cache (stat_key, stat_date, stat_value, expires_at)
SELECT 
  'daily_transactions',
  DATE(created_at),
  JSON_OBJECT(
    'count', COUNT(*),
    'total_amount', SUM(amount),
    'avg_amount', AVG(amount),
    'deposit_count', SUM(CASE WHEN type = 'deposit' THEN 1 ELSE 0 END),
    'withdraw_count', SUM(CASE WHEN type = 'withdraw' THEN 1 ELSE 0 END)
  ),
  DATE_ADD(NOW(), INTERVAL 1 DAY)
FROM transactions 
WHERE DATE(created_at) = CURDATE()
GROUP BY DATE(created_at)
ON DUPLICATE KEY UPDATE 
  stat_value = VALUES(stat_value),
  updated_at = NOW();

-- 2. Êü•ËØ¢‰ºòÂåñÂêéÁöÑÁªüËÆ°Êï∞ÊçÆ
SELECT stat_date, stat_value 
FROM data_statistics_cache 
WHERE stat_key = 'daily_transactions' 
  AND stat_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
ORDER BY stat_date;
```

### 2. ÂàÜÈ°µÊü•ËØ¢‰ºòÂåñ

#### Ê∑±Â∫¶ÂàÜÈ°µ‰ºòÂåñ
```sql
-- ‰ºòÂåñÂâçÔºö‰º†ÁªüOFFSETÂàÜÈ°µÔºàÊÄßËÉΩÈöèÈ°µÊï∞Â¢ûÂä†ËÄå‰∏ãÈôçÔºâ
SELECT * FROM transactions 
ORDER BY created_at DESC 
LIMIT 20 OFFSET 10000;

-- ‰ºòÂåñÂêéÔºöÂü∫‰∫éÊ∏∏Ê†áÁöÑÂàÜÈ°µ
-- Á¨¨‰∏ÄÈ°µ
SELECT * FROM transactions 
ORDER BY created_at DESC, id DESC 
LIMIT 20;

-- ÂêéÁª≠È°µÔºà‰ΩøÁî®‰∏ä‰∏ÄÈ°µÊúÄÂêé‰∏ÄÊù°ËÆ∞ÂΩïÁöÑcreated_atÂíåid‰Ωú‰∏∫Ê∏∏Ê†áÔºâ
SELECT * FROM transactions 
WHERE (created_at < '2024-01-15 10:30:00' OR 
       (created_at = '2024-01-15 10:30:00' AND id < 12345))
ORDER BY created_at DESC, id DESC 
LIMIT 20;
```

#### ÂàÜÈ°µÊü•ËØ¢Â∞ÅË£Ö
```javascript
/**
 * È´òÊÄßËÉΩÂàÜÈ°µÊü•ËØ¢Á±ª
 */
class OptimizedPagination {
  /**
   * Âü∫‰∫éÊ∏∏Ê†áÁöÑÂàÜÈ°µÊü•ËØ¢
   * @param {Object} options - Êü•ËØ¢ÈÄâÈ°π
   */
  async cursorBasedPagination(options) {
    const {
      table,
      orderBy = 'created_at',
      orderDirection = 'DESC',
      limit = 20,
      cursor = null,
      where = '',
      params = []
    } = options;
    
    let sql = `SELECT * FROM ${table}`;
    let queryParams = [...params];
    
    // ÊûÑÂª∫WHEREÊù°‰ª∂
    const whereConditions = [];
    if (where) {
      whereConditions.push(where);
    }
    
    // Ê∑ªÂä†Ê∏∏Ê†áÊù°‰ª∂
    if (cursor) {
      const cursorCondition = orderDirection === 'DESC' 
        ? `${orderBy} < ?` 
        : `${orderBy} > ?`;
      whereConditions.push(cursorCondition);
      queryParams.push(cursor);
    }
    
    if (whereConditions.length > 0) {
      sql += ` WHERE ${whereConditions.join(' AND ')}`;
    }
    
    sql += ` ORDER BY ${orderBy} ${orderDirection} LIMIT ?`;
    queryParams.push(limit + 1); // Â§öÊü•ËØ¢‰∏ÄÊù°Áî®‰∫éÂà§Êñ≠ÊòØÂê¶Êúâ‰∏ã‰∏ÄÈ°µ
    
    const results = await db.query(sql, queryParams);
    
    const hasNextPage = results.length > limit;
    if (hasNextPage) {
      results.pop(); // ÁßªÈô§Â§öÊü•ËØ¢ÁöÑÈÇ£‰∏ÄÊù°
    }
    
    const nextCursor = results.length > 0 
      ? results[results.length - 1][orderBy] 
      : null;
    
    return {
      data: results,
      hasNextPage,
      nextCursor,
      total: hasNextPage ? null : results.length // Âè™Âú®ÊúÄÂêé‰∏ÄÈ°µËÆ°ÁÆóÊÄªÊï∞
    };
  }
  
  /**
   * Êô∫ËÉΩÂàÜÈ°µÔºàËá™Âä®ÈÄâÊã©ÊúÄ‰ºòÁ≠ñÁï•Ôºâ
   */
  async smartPagination(options) {
    const { page = 1, limit = 20 } = options;
    
    // ÊµÖÂàÜÈ°µ‰ΩøÁî®OFFSETÔºåÊ∑±ÂàÜÈ°µ‰ΩøÁî®Ê∏∏Ê†á
    if (page <= 100) {
      return await this.offsetBasedPagination(options);
    } else {
      return await this.cursorBasedPagination(options);
    }
  }
}
```

## ÊÄßËÉΩË∞É‰ºòÁ≠ñÁï•

### 1. MySQLÈÖçÁΩÆ‰ºòÂåñ

#### ÊúçÂä°Âô®ÈÖçÁΩÆ‰ºòÂåñ
```ini
# my.cnf ‰ºòÂåñÈÖçÁΩÆ
[mysqld]
# Âü∫Á°ÄÈÖçÁΩÆ
port = 3306
socket = /var/lib/mysql/mysql.sock
datadir = /var/lib/mysql

# ÂÜÖÂ≠òÈÖçÁΩÆ
innodb_buffer_pool_size = 2G          # ËÆæÁΩÆ‰∏∫Áâ©ÁêÜÂÜÖÂ≠òÁöÑ70-80%
innodb_log_file_size = 256M           # Êó•ÂøóÊñá‰ª∂Â§ßÂ∞è
innodb_log_buffer_size = 16M          # Êó•ÂøóÁºìÂÜ≤Âå∫Â§ßÂ∞è
key_buffer_size = 256M                # MyISAMÁ¥¢ÂºïÁºìÂÜ≤Âå∫
query_cache_size = 128M               # Êü•ËØ¢ÁºìÂ≠òÂ§ßÂ∞è
tmp_table_size = 64M                  # ‰∏¥Êó∂Ë°®Â§ßÂ∞è
max_heap_table_size = 64M             # ÂÜÖÂ≠òË°®ÊúÄÂ§ßÂ§ßÂ∞è

# ËøûÊé•ÈÖçÁΩÆ
max_connections = 500                 # ÊúÄÂ§ßËøûÊé•Êï∞
max_connect_errors = 1000            # ÊúÄÂ§ßËøûÊé•ÈîôËØØÊï∞
connect_timeout = 10                 # ËøûÊé•Ë∂ÖÊó∂Êó∂Èó¥
wait_timeout = 600                   # Á≠âÂæÖË∂ÖÊó∂Êó∂Èó¥
interactive_timeout = 600            # ‰∫§‰∫íË∂ÖÊó∂Êó∂Èó¥

# InnoDBÈÖçÁΩÆ
innodb_file_per_table = 1            # ÊØè‰∏™Ë°®ÂçïÁã¨Êñá‰ª∂
innodb_flush_log_at_trx_commit = 2   # Êó•ÂøóÂà∑Êñ∞Á≠ñÁï•
innodb_flush_method = O_DIRECT       # Âà∑Êñ∞ÊñπÊ≥ï
innodb_lock_wait_timeout = 50        # ÈîÅÁ≠âÂæÖË∂ÖÊó∂
innodb_rollback_on_timeout = 1       # Ë∂ÖÊó∂ÂõûÊªö
innodb_thread_concurrency = 8       # Á∫øÁ®ãÂπ∂ÂèëÊï∞

# Êü•ËØ¢‰ºòÂåñ
slow_query_log = 1                   # ÂêØÁî®ÊÖ¢Êü•ËØ¢Êó•Âøó
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 1                  # ÊÖ¢Êü•ËØ¢ÈòàÂÄº(Áßí)
log_queries_not_using_indexes = 1    # ËÆ∞ÂΩïÊú™‰ΩøÁî®Á¥¢ÂºïÁöÑÊü•ËØ¢

# ‰∫åËøõÂà∂Êó•Âøó
log_bin = mysql-bin                  # ÂêØÁî®‰∫åËøõÂà∂Êó•Âøó
binlog_format = ROW                  # ‰∫åËøõÂà∂Êó•ÂøóÊ†ºÂºè
expire_logs_days = 7                 # Êó•Âøó‰øùÁïôÂ§©Êï∞
max_binlog_size = 100M              # Âçï‰∏™Êó•ÂøóÊñá‰ª∂ÊúÄÂ§ßÂ§ßÂ∞è

# ÂÖ∂‰ªñ‰ºòÂåñ
table_open_cache = 2000             # Ë°®ÁºìÂ≠òÊï∞Èáè
thread_cache_size = 50              # Á∫øÁ®ãÁºìÂ≠òÂ§ßÂ∞è
sort_buffer_size = 2M               # ÊéíÂ∫èÁºìÂÜ≤Âå∫Â§ßÂ∞è
read_buffer_size = 1M               # ËØªÁºìÂÜ≤Âå∫Â§ßÂ∞è
read_rnd_buffer_size = 2M           # ÈöèÊú∫ËØªÁºìÂÜ≤Âå∫Â§ßÂ∞è
```

### 2. ËøûÊé•Ê±†‰ºòÂåñ

#### Node.jsËøûÊé•Ê±†ÈÖçÁΩÆ
```javascript
/**
 * Êï∞ÊçÆÂ∫ìËøûÊé•Ê±†‰ºòÂåñÈÖçÁΩÆ
 */
const mysql = require('mysql2/promise');

const dbConfig = {
  host: process.env.DB_HOST,
  port: process.env.DB_PORT || 3306,
  user: process.env.DB_USER,
  password: process.env.DB_PASSWORD,
  database: process.env.DB_NAME,
  
  // ËøûÊé•Ê±†ÈÖçÁΩÆ
  connectionLimit: 20,              // ÊúÄÂ§ßËøûÊé•Êï∞
  acquireTimeout: 60000,           // Ëé∑ÂèñËøûÊé•Ë∂ÖÊó∂Êó∂Èó¥
  timeout: 60000,                  // Êü•ËØ¢Ë∂ÖÊó∂Êó∂Èó¥
  reconnect: true,                 // Ëá™Âä®ÈáçËøû
  
  // ÊÄßËÉΩ‰ºòÂåñ
  multipleStatements: false,       // Á¶ÅÁî®Â§öËØ≠Âè•Êü•ËØ¢ÔºàÂÆâÂÖ®ËÄÉËôëÔºâ
  dateStrings: false,              // Êó•ÊúüÁ±ªÂûãÂ§ÑÁêÜ
  supportBigNumbers: true,         // ÊîØÊåÅÂ§ßÊï∞Â≠ó
  bigNumberStrings: true,          // Â§ßÊï∞Â≠óËΩ¨Â≠óÁ¨¶‰∏≤
  
  // SSLÈÖçÁΩÆÔºàÁîü‰∫ßÁéØÂ¢ÉÔºâ
  ssl: process.env.NODE_ENV === 'production' ? {
    rejectUnauthorized: false
  } : false
};

// ÂàõÂª∫ËøûÊé•Ê±†
const pool = mysql.createPool(dbConfig);

/**
 * Êï∞ÊçÆÂ∫ìËøûÊé•ÁÆ°ÁêÜÂô®
 */
class DatabaseManager {
  constructor() {
    this.pool = pool;
    this.setupMonitoring();
  }
  
  /**
   * ÊâßË°åÊü•ËØ¢
   */
  async query(sql, params = []) {
    const start = Date.now();
    let connection;
    
    try {
      connection = await this.pool.getConnection();
      const [results] = await connection.execute(sql, params);
      
      // ËÆ∞ÂΩïÊÖ¢Êü•ËØ¢
      const duration = Date.now() - start;
      if (duration > 1000) {
        console.warn(`ÊÖ¢Êü•ËØ¢Ê£ÄÊµã: ${duration}ms`, { sql, params });
      }
      
      return results;
    } catch (error) {
      console.error('Êï∞ÊçÆÂ∫ìÊü•ËØ¢ÈîôËØØ:', error);
      throw error;
    } finally {
      if (connection) connection.release();
    }
  }
  
  /**
   * ‰∫ãÂä°ÊâßË°å
   */
  async transaction(callback) {
    const connection = await this.pool.getConnection();
    
    try {
      await connection.beginTransaction();
      const result = await callback(connection);
      await connection.commit();
      return result;
    } catch (error) {
      await connection.rollback();
      throw error;
    } finally {
      connection.release();
    }
  }
  
  /**
   * ËøûÊé•Ê±†ÁõëÊéß
   */
  setupMonitoring() {
    setInterval(() => {
      const stats = {
        totalConnections: this.pool.pool._allConnections.length,
        freeConnections: this.pool.pool._freeConnections.length,
        usedConnections: this.pool.pool._allConnections.length - this.pool.pool._freeConnections.length
      };
      
      console.log('Êï∞ÊçÆÂ∫ìËøûÊé•Ê±†Áä∂ÊÄÅ:', stats);
      
      // ËøûÊé•Ê±†‰ΩøÁî®ÁéáÂëäË≠¶
      const usageRate = stats.usedConnections / stats.totalConnections;
      if (usageRate > 0.8) {
        console.warn('Êï∞ÊçÆÂ∫ìËøûÊé•Ê±†‰ΩøÁî®ÁéáËøáÈ´ò:', usageRate);
      }
    }, 30000); // ÊØè30ÁßíÊ£ÄÊü•‰∏ÄÊ¨°
  }
}
```

### 3. ÁºìÂ≠òÁ≠ñÁï•

#### RedisÁºìÂ≠ò‰ºòÂåñ
```javascript
/**
 * Êï∞ÊçÆÂ∫ìÊü•ËØ¢ÁºìÂ≠òÁÆ°ÁêÜ
 */
class QueryCache {
  constructor(redisClient) {
    this.redis = redisClient;
    this.defaultTTL = 300; // 5ÂàÜÈíüÈªòËÆ§ËøáÊúüÊó∂Èó¥
  }
  
  /**
   * ÁºìÂ≠òÊü•ËØ¢ÁªìÊûú
   */
  async cacheQuery(key, queryFn, ttl = this.defaultTTL) {
    // Â∞ùËØï‰ªéÁºìÂ≠òËé∑Âèñ
    const cached = await this.redis.get(key);
    if (cached) {
      return JSON.parse(cached);
    }
    
    // ÊâßË°åÊü•ËØ¢
    const result = await queryFn();
    
    // ÁºìÂ≠òÁªìÊûú
    await this.redis.setex(key, ttl, JSON.stringify(result));
    
    return result;
  }
  
  /**
   * Áî®Êà∑Êï∞ÊçÆÁºìÂ≠ò
   */
  async getUserData(userId) {
    const cacheKey = `user:${userId}`;
    
    return await this.cacheQuery(cacheKey, async () => {
      const user = await db.query(
        'SELECT * FROM users WHERE id = ? AND deleted_at IS NULL',
        [userId]
      );
      return user[0];
    }, 600); // 10ÂàÜÈíüÁºìÂ≠ò
  }
  
  /**
   * Áî®Êà∑Èí±ÂåÖÁºìÂ≠ò
   */
  async getUserWallets(userId) {
    const cacheKey = `user_wallets:${userId}`;
    
    return await this.cacheQuery(cacheKey, async () => {
      return await db.query(
        'SELECT * FROM wallets WHERE user_id = ? AND status = "active"',
        [userId]
      );
    }, 300); // 5ÂàÜÈíüÁºìÂ≠ò
  }
  
  /**
   * ÁªüËÆ°Êï∞ÊçÆÁºìÂ≠ò
   */
  async getStatistics(statType, date) {
    const cacheKey = `stats:${statType}:${date}`;
    
    return await this.cacheQuery(cacheKey, async () => {
      // ‰ªéÁªüËÆ°ÁºìÂ≠òË°®Ëé∑ÂèñÊï∞ÊçÆ
      const stats = await db.query(
        'SELECT stat_value FROM data_statistics_cache WHERE stat_key = ? AND stat_date = ?',
        [statType, date]
      );
      
      return stats[0]?.stat_value || {};
    }, 3600); // 1Â∞èÊó∂ÁºìÂ≠ò
  }
  
  /**
   * ÊâπÈáèÊ∏ÖÈô§ÁºìÂ≠ò
   */
  async clearUserCache(userId) {
    const patterns = [
      `user:${userId}`,
      `user_wallets:${userId}`,
      `user_transactions:${userId}*`
    ];
    
    for (const pattern of patterns) {
      const keys = await this.redis.keys(pattern);
      if (keys.length > 0) {
        await this.redis.del(...keys);
      }
    }
  }
}
```

## Êï∞ÊçÆÂ∫ìÁõëÊéßÂíåÁª¥Êä§

### 1. ÊÄßËÉΩÁõëÊéß

#### ÂÆûÊó∂ÁõëÊéßÊåáÊ†á
```javascript
/**
 * Êï∞ÊçÆÂ∫ìÊÄßËÉΩÁõëÊéß
 */
class DatabaseMonitor {
  constructor(db) {
    this.db = db;
    this.metrics = {
      queryCount: 0,
      slowQueryCount: 0,
      errorCount: 0,
      avgResponseTime: 0
    };
  }
  
  /**
   * Êî∂ÈõÜÊÄßËÉΩÊåáÊ†á
   */
  async collectMetrics() {
    const metrics = {};
    
    // ËøûÊé•Êï∞ÁªüËÆ°
    const [connections] = await this.db.query('SHOW STATUS LIKE "Threads_connected"');
    metrics.activeConnections = parseInt(connections.Value);
    
    // Êü•ËØ¢ÁªüËÆ°
    const [queries] = await this.db.query('SHOW STATUS LIKE "Questions"');
    metrics.totalQueries = parseInt(queries.Value);
    
    // ÊÖ¢Êü•ËØ¢ÁªüËÆ°
    const [slowQueries] = await this.db.query('SHOW STATUS LIKE "Slow_queries"');
    metrics.slowQueries = parseInt(slowQueries.Value);
    
    // InnoDBÁºìÂÜ≤Ê±†ÂëΩ‰∏≠Áéá
    const [bufferPoolReads] = await this.db.query('SHOW STATUS LIKE "Innodb_buffer_pool_reads"');
    const [bufferPoolReadRequests] = await this.db.query('SHOW STATUS LIKE "Innodb_buffer_pool_read_requests"');
    
    const reads = parseInt(bufferPoolReads.Value);
    const readRequests = parseInt(bufferPoolReadRequests.Value);
    metrics.bufferPoolHitRate = ((readRequests - reads) / readRequests * 100).toFixed(2);
    
    // ÈîÅÁ≠âÂæÖÁªüËÆ°
    const [lockWaits] = await this.db.query('SHOW STATUS LIKE "Innodb_row_lock_waits"');
    metrics.lockWaits = parseInt(lockWaits.Value);
    
    return metrics;
  }
  
  /**
   * Ê£ÄÊü•Ë°®Á©∫Èó¥‰ΩøÁî®ÊÉÖÂÜµ
   */
  async checkTablespaceUsage() {
    const [tables] = await this.db.query(`
      SELECT 
        table_name,
        ROUND(((data_length + index_length) / 1024 / 1024), 2) AS size_mb,
        table_rows,
        ROUND((data_length / 1024 / 1024), 2) AS data_size_mb,
        ROUND((index_length / 1024 / 1024), 2) AS index_size_mb
      FROM information_schema.tables 
      WHERE table_schema = DATABASE()
      ORDER BY (data_length + index_length) DESC
    `);
    
    return tables;
  }
  
  /**
   * ÂàÜÊûêÁ¥¢Âºï‰ΩøÁî®ÊÉÖÂÜµ
   */
  async analyzeIndexUsage() {
    const [indexes] = await this.db.query(`
      SELECT 
        t.table_name,
        t.index_name,
        t.column_name,
        s.rows_read,
        s.rows_examined
      FROM information_schema.statistics t
      LEFT JOIN performance_schema.table_io_waits_summary_by_index_usage s
        ON t.table_schema = s.object_schema 
        AND t.table_name = s.object_name 
        AND t.index_name = s.index_name
      WHERE t.table_schema = DATABASE()
        AND s.rows_read IS NOT NULL
      ORDER BY s.rows_examined DESC
    `);
    
    return indexes;
  }
}
```

### 2. Ëá™Âä®ÂåñÁª¥Êä§

#### Êï∞ÊçÆÊ∏ÖÁêÜ‰ªªÂä°
```javascript
/**
 * Êï∞ÊçÆÂ∫ìÁª¥Êä§‰ªªÂä°
 */
class DatabaseMaintenance {
  constructor(db) {
    this.db = db;
  }
  
  /**
   * Ê∏ÖÁêÜËøáÊúüÊï∞ÊçÆ
   */
  async cleanupExpiredData() {
    const tasks = [
      // Ê∏ÖÁêÜËøáÊúüÁöÑÁªüËÆ°ÁºìÂ≠ò
      {
        name: 'Ê∏ÖÁêÜËøáÊúüÁªüËÆ°ÁºìÂ≠ò',
        sql: 'DELETE FROM data_statistics_cache WHERE expires_at < NOW()',
        expectedRows: 0
      },
      
      // ÂΩíÊ°£ÊóßÁöÑÊìç‰ΩúÊó•Âøó
      {
        name: 'ÂΩíÊ°£Êìç‰ΩúÊó•Âøó',
        sql: `
          INSERT INTO admin_operation_logs_archive 
          SELECT * FROM admin_operation_logs 
          WHERE created_at < DATE_SUB(NOW(), INTERVAL 3 MONTH)
        `,
        expectedRows: 0
      },
      
      // Âà†Èô§Â∑≤ÂΩíÊ°£ÁöÑÊìç‰ΩúÊó•Âøó
      {
        name: 'Âà†Èô§Â∑≤ÂΩíÊ°£Êìç‰ΩúÊó•Âøó',
        sql: 'DELETE FROM admin_operation_logs WHERE created_at < DATE_SUB(NOW(), INTERVAL 3 MONTH)',
        expectedRows: 0
      }
    ];
    
    const results = [];
    
    for (const task of tasks) {
      try {
        const result = await this.db.query(task.sql);
        results.push({
          task: task.name,
          success: true,
          affectedRows: result.affectedRows
        });
        
        console.log(`${task.name} ÂÆåÊàêÔºåÂΩ±ÂìçË°åÊï∞: ${result.affectedRows}`);
      } catch (error) {
        results.push({
          task: task.name,
          success: false,
          error: error.message
        });
        
        console.error(`${task.name} Â§±Ë¥•:`, error);
      }
    }
    
    return results;
  }
  
  /**
   * ‰ºòÂåñË°®ÁªìÊûÑ
   */
  async optimizeTables() {
    // Ëé∑ÂèñÈúÄË¶Å‰ºòÂåñÁöÑË°®
    const [tables] = await this.db.query(`
      SELECT table_name, data_free
      FROM information_schema.tables 
      WHERE table_schema = DATABASE() 
        AND data_free > 1024 * 1024 * 10  -- Á¢éÁâáË∂ÖËøá10MB
      ORDER BY data_free DESC
    `);
    
    const results = [];
    
    for (const table of tables) {
      try {
        console.log(`ÂºÄÂßã‰ºòÂåñË°®: ${table.table_name}`);
        await this.db.query(`OPTIMIZE TABLE ${table.table_name}`);
        
        results.push({
          table: table.table_name,
          success: true,
          freedSpace: table.data_free
        });
        
        console.log(`Ë°® ${table.table_name} ‰ºòÂåñÂÆåÊàê`);
      } catch (error) {
        results.push({
          table: table.table_name,
          success: false,
          error: error.message
        });
        
        console.error(`Ë°® ${table.table_name} ‰ºòÂåñÂ§±Ë¥•:`, error);
      }
    }
    
    return results;
  }
  
  /**
   * Êõ¥Êñ∞Ë°®ÁªüËÆ°‰ø°ÊÅØ
   */
  async updateTableStatistics() {
    const [tables] = await this.db.query(`
      SELECT table_name 
      FROM information_schema.tables 
      WHERE table_schema = DATABASE()
    `);
    
    for (const table of tables) {
      try {
        await this.db.query(`ANALYZE TABLE ${table.table_name}`);
        console.log(`Ë°® ${table.table_name} ÁªüËÆ°‰ø°ÊÅØÊõ¥Êñ∞ÂÆåÊàê`);
      } catch (error) {
        console.error(`Ë°® ${table.table_name} ÁªüËÆ°‰ø°ÊÅØÊõ¥Êñ∞Â§±Ë¥•:`, error);
      }
    }
  }
}
```

## Êâ©Â±ïÊÄßËÆæËÆ°

### 1. ËØªÂÜôÂàÜÁ¶ª

#### ‰∏ª‰ªéÈÖçÁΩÆ
```javascript
/**
 * ËØªÂÜôÂàÜÁ¶ªÊï∞ÊçÆÂ∫ìÁÆ°ÁêÜ
 */
class MasterSlaveDB {
  constructor() {
    // ‰∏ªÂ∫ìËøûÊé•ÔºàÂÜôÊìç‰ΩúÔºâ
    this.masterPool = mysql.createPool({
      ...dbConfig,
      host: process.env.DB_MASTER_HOST,
      connectionLimit: 10
    });
    
    // ‰ªéÂ∫ìËøûÊé•ÔºàËØªÊìç‰ΩúÔºâ
    this.slavePool = mysql.createPool({
      ...dbConfig,
      host: process.env.DB_SLAVE_HOST,
      connectionLimit: 20
    });
  }
  
  /**
   * ÂÜôÊìç‰ΩúÔºà‰ΩøÁî®‰∏ªÂ∫ìÔºâ
   */
  async write(sql, params = []) {
    const connection = await this.masterPool.getConnection();
    try {
      const [result] = await connection.execute(sql, params);
      return result;
    } finally {
      connection.release();
    }
  }
  
  /**
   * ËØªÊìç‰ΩúÔºà‰ΩøÁî®‰ªéÂ∫ìÔºâ
   */
  async read(sql, params = []) {
    const connection = await this.slavePool.getConnection();
    try {
      const [result] = await connection.execute(sql, params);
      return result;
    } catch (error) {
      // ‰ªéÂ∫ìÂ§±Ë¥•Êó∂ÂõûÈÄÄÂà∞‰∏ªÂ∫ì
      console.warn('‰ªéÂ∫ìÊü•ËØ¢Â§±Ë¥•ÔºåÂõûÈÄÄÂà∞‰∏ªÂ∫ì:', error.message);
      return await this.write(sql, params);
    } finally {
      connection.release();
    }
  }
  
  /**
   * ‰∫ãÂä°Êìç‰ΩúÔºàÂøÖÈ°ª‰ΩøÁî®‰∏ªÂ∫ìÔºâ
   */
  async transaction(callback) {
    const connection = await this.masterPool.getConnection();
    try {
      await connection.beginTransaction();
      const result = await callback(connection);
      await connection.commit();
      return result;
    } catch (error) {
      await connection.rollback();
      throw error;
    } finally {
      connection.release();
    }
  }
}
```

### 2. ÂàÜÂ∫ìÂàÜË°®Á≠ñÁï•

#### Ê∞¥Âπ≥ÂàÜË°®ÂÆûÁé∞
```javascript
/**
 * ÂàÜË°®Ë∑ØÁî±ÁÆ°ÁêÜ
 */
class ShardingManager {
  constructor() {
    this.shardCount = 4; // ÂàÜË°®Êï∞Èáè
  }
  
  /**
   * Ê†πÊçÆÁî®Êà∑IDËÆ°ÁÆóÂàÜË°®
   */
  getShardTable(tableName, userId) {
    const shardIndex = userId % this.shardCount;
    return `${tableName}_${shardIndex}`;
  }
  
  /**
   * ÂàÜË°®Êü•ËØ¢
   */
  async queryShardTable(tableName, userId, sql, params = []) {
    const shardTable = this.getShardTable(tableName, userId);
    const shardSql = sql.replace(new RegExp(tableName, 'g'), shardTable);
    
    return await db.query(shardSql, params);
  }
  
  /**
   * Ë∑®ÂàÜË°®Êü•ËØ¢
   */
  async queryAllShards(tableName, sql, params = []) {
    const promises = [];
    
    for (let i = 0; i < this.shardCount; i++) {
      const shardTable = `${tableName}_${i}`;
      const shardSql = sql.replace(new RegExp(tableName, 'g'), shardTable);
      promises.push(db.query(shardSql, params));
    }
    
    const results = await Promise.all(promises);
    return results.flat();
  }
}
```

## ÊÄªÁªì

Êú¨Êï∞ÊçÆÂ∫ì‰ºòÂåñÂª∫ËÆÆÊñáÊ°£Êèê‰æõ‰∫ÜÂÖ®Èù¢ÁöÑ‰ºòÂåñÊñπÊ°àÔºö

### Ê†∏ÂøÉ‰ºòÂåñÁÇπ
1. **Ë°®ÁªìÊûÑ‰ºòÂåñ** - ÈáçÊûÑÊ†∏ÂøÉË°®ÔºåÊ∑ªÂä†ÂøÖË¶ÅÂ≠óÊÆµÂíåÁ∫¶Êùü
2. **Á¥¢ÂºïÁ≠ñÁï•** - ËÆæËÆ°Â§çÂêàÁ¥¢ÂºïÔºåÊèêÂçáÊü•ËØ¢ÊÄßËÉΩ
3. **Êü•ËØ¢‰ºòÂåñ** - ÈáçÂÜôÊÖ¢Êü•ËØ¢Ôºå‰ΩøÁî®ÁºìÂ≠òÂíåÂàÜÈ°µ‰ºòÂåñ
4. **ÊÄßËÉΩË∞É‰ºò** - MySQLÈÖçÁΩÆ„ÄÅËøûÊé•Ê±†„ÄÅÁºìÂ≠òÁ≠ñÁï•
5. **ÁõëÊéßÁª¥Êä§** - ÂÆûÊó∂ÁõëÊéß„ÄÅËá™Âä®ÂåñÁª¥Êä§‰ªªÂä°

### È¢ÑÊúüÊïàÊûú
- Êü•ËØ¢ÊÄßËÉΩÊèêÂçá60-80%
- ÊîØÊåÅÊõ¥Â§ßÁöÑÂπ∂ÂèëËÆøÈóÆÈáè
- ÂáèÂ∞ëÁ≥ªÁªüËµÑÊ∫êÊ∂àËÄó
- ÊèêÈ´òÊï∞ÊçÆÂÆâÂÖ®ÊÄßÂíå‰∏ÄËá¥ÊÄß
- ÊîØÊåÅ‰∏öÂä°Âø´ÈÄüÊâ©Â±ï

### ÂÆûÊñΩÂª∫ËÆÆ
1. **ÂàÜÈò∂ÊÆµÂÆûÊñΩ** - Êåâ‰ºòÂÖàÁ∫ßÈÄêÊ≠•‰ºòÂåñ
2. **ÂÖÖÂàÜÊµãËØï** - Âú®ÊµãËØïÁéØÂ¢ÉÈ™åËØÅÊâÄÊúâ‰ºòÂåñ
3. **ÁõëÊéßË∑üË∏™** - ÂÆûÊó∂ÁõëÊéß‰ºòÂåñÊïàÊûú
4. **Â§á‰ªΩ‰øùÊä§** - Á°Æ‰øùÊï∞ÊçÆÂÆâÂÖ®
5. **ÊñáÊ°£Êõ¥Êñ∞** - ÂèäÊó∂Êõ¥Êñ∞Áõ∏ÂÖ≥ÊñáÊ°£

ËØ•‰ºòÂåñÊñπÊ°àÂ∞ÜÊòæËëóÊèêÂçáÁÆ°ÁêÜÂêéÂè∞Á≥ªÁªüÁöÑÊï∞ÊçÆÂ§ÑÁêÜËÉΩÂäõÂíåÁî®Êà∑‰ΩìÈ™å„ÄÇ