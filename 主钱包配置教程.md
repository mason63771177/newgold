# 🏦 主钱包地址配置教程

## 📋 概述

本教程将指导您如何在"裂金7日"项目中配置主钱包地址，实现中心化钱包功能。主钱包地址是资金归集的核心，所有用户的充值资金最终都会汇聚到这个地址。

## 🎯 主钱包地址的作用

1. **资金归集目标**：所有用户子钱包的资金都会定期汇聚到主钱包
2. **提现资金来源**：用户提现时，资金从主钱包发出
3. **运营资金管理**：便于统一管理和监控所有资金流动
4. **手续费收取**：提现手续费也会转入主钱包

## 🔧 配置步骤

### 步骤1：准备主钱包地址

您需要准备一个TRON网络的钱包地址作为主钱包，推荐使用以下方式：

#### 方式1：使用现有钱包
- 使用TronLink、imToken等钱包创建新地址
- 确保您完全控制该地址的私钥
- 地址格式：`T` 开头的34位字符串（如：`TYeVe8dn6NEZYwUiu7GmFpF8jsP8uMTrNZ`）

#### 方式2：使用系统生成的主钱包
- 运行主钱包生成脚本：
```bash
cd /Users/mason1236/0930/backend
node scripts/generate-master-wallet.js
```

### 步骤2：配置环境变量

打开 `/Users/mason1236/0930/backend/.env` 文件，找到以下配置项：

```env
# 支付钱包配置（主钱包）
PAYMENT_WALLET_ADDRESS=your-payment-wallet-address
PAYMENT_PRIVATE_KEY=your-payment-private-key

# 主钱包配置（资金归集目标）
MASTER_WALLET_ADDRESS=your-master-wallet-address
```

### 步骤3：填写配置

将您的主钱包信息填入对应位置：

```env
# 示例配置（请替换为您的真实地址）
PAYMENT_WALLET_ADDRESS=TYeVe8dn6NEZYwUiu7GmFpF8jsP8uMTrNZ
PAYMENT_PRIVATE_KEY=您的主钱包私钥（64位十六进制字符串）

# 主钱包地址（通常与PAYMENT_WALLET_ADDRESS相同）
MASTER_WALLET_ADDRESS=TYeVe8dn6NEZYwUiu7GmFpF8jsP8uMTrNZ
```

## ⚠️ 重要安全提示

### 1. 私钥安全
- **绝对不要**将私钥提交到代码仓库
- **绝对不要**在聊天工具中发送私钥
- 建议将私钥写在纸上，存放在安全的地方
- 生产环境建议使用硬件钱包或HSM

### 2. 地址验证
配置完成后，请验证地址格式：
- TRON主网地址以 `T` 开头
- 长度为34个字符
- 可以在 [TRONSCAN](https://tronscan.org) 上查询地址信息

### 3. 测试网络配置
如果使用测试网络，请确保：
```env
TATUM_NETWORK=testnet
TATUM_TESTNET=true
```

## 🧪 配置验证

### 1. 检查配置是否生效
运行以下命令验证配置：
```bash
cd /Users/mason1236/0930/backend
node scripts/test-fund-consolidation.js
```

### 2. 查看配置信息
脚本会显示当前配置的主钱包地址：
```
🏦 主钱包地址: TYeVe8dn6NEZYwUiu7GmFpF8jsP8uMTrNZ
```

### 3. 测试资金归集
如果有测试资金，可以运行资金归集测试：
```bash
# 登录系统获取token
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"123456"}'

# 测试资金归集
curl -X POST http://localhost:3000/api/wallet/admin/consolidate-funds \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json"
```

## 📁 相关文件位置

### 配置文件
- 环境变量：`/Users/mason1236/0930/backend/.env`
- 主钱包生成脚本：`/Users/mason1236/0930/backend/scripts/generate-master-wallet.js`

### 服务文件
- 资金归集服务：`/Users/mason1236/0930/backend/services/fundConsolidationService.js`
- Tatum钱包服务：`/Users/mason1236/0930/backend/services/tatumWalletService.js`

### API接口
- 钱包路由：`/Users/mason1236/0930/backend/routes/wallet.js`
- 资金归集接口：`POST /api/wallet/admin/consolidate-funds`

## 🔄 工作流程

### 1. 用户充值流程
```
用户转账 → 用户专属地址 → 系统检测到账 → 更新用户余额
```

### 2. 资金归集流程
```
定时任务/手动触发 → 扫描所有用户地址 → 将余额转入主钱包 → 记录归集交易
```

### 3. 用户提现流程
```
用户申请提现 → 系统验证余额 → 从主钱包转账 → 扣除手续费 → 更新余额
```

## 🚀 快速配置示例

如果您想快速开始测试，可以使用以下配置：

1. **生成测试主钱包**：
```bash
cd /Users/mason1236/0930/backend
node scripts/generate-master-wallet.js
```

2. **复制生成的配置到.env文件**：
```env
# 将生成的配置复制到这里
TATUM_MASTER_WALLET_MNEMONIC="生成的助记词"
TATUM_MASTER_WALLET_XPUB=生成的xPub
PAYMENT_WALLET_ADDRESS=生成的第一个地址
PAYMENT_PRIVATE_KEY=生成的第一个私钥
MASTER_WALLET_ADDRESS=生成的第一个地址
```

3. **重启服务**：
```bash
# 停止当前服务（Ctrl+C）
# 重新启动
npm start
```

## 📞 技术支持

如果在配置过程中遇到问题：

1. **检查日志**：查看 `/Users/mason1236/0930/backend/logs/` 目录下的日志文件
2. **验证网络**：确保网络连接正常，可以访问Tatum API
3. **检查余额**：确保主钱包有足够的TRX作为手续费

## ✅ 配置完成检查清单

- [ ] 已设置 `PAYMENT_WALLET_ADDRESS`
- [ ] 已设置 `PAYMENT_PRIVATE_KEY`
- [ ] 已设置 `MASTER_WALLET_ADDRESS`
- [ ] 地址格式正确（T开头，34位字符）
- [ ] 私钥格式正确（64位十六进制）
- [ ] 已重启服务
- [ ] 已验证配置生效
- [ ] 主钱包有足够TRX余额

配置完成后，您的中心化钱包系统就可以正常运行了！🎉