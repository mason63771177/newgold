<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>裂金7日 · 提现</title>
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QQ6GQ79K7G"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-QQ6GQ79K7G');
  </script>
  
  
  <style>:root{--bg:#0b0f14;--panel:#111823;--card:#0e141d;--brand:#56ccf2;--brand-2:#2f80ed;--text:#e6efff;--muted:#9fb3cd;--accent-border:rgba(111,158,255,.18);--error:#ff5d5d;--success:#00e3ae;--safe:env(safe-area-inset-bottom,0px)}body,html{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,PingFang SC,Hiragino Sans GB,Microsoft YaHei,sans-serif;font-size:16px;height:100vh;margin:0;overflow:hidden;padding:0}.container{display:flex;flex-direction:column;height:100vh}.header{align-items:center;display:flex;flex:0 0 80px;justify-content:center;padding-top:8px;position:relative}.header h1{background:linear-gradient(45deg,#2193b0,#6dd5ed);-webkit-background-clip:text;background-clip:text;font-size:18px;font-weight:700;-webkit-text-fill-color:transparent;filter:drop-shadow(0 0 12px rgba(109,213,237,.5)) drop-shadow(0 0 24px rgba(109,213,237,.3));margin:0}.logo-small{filter:drop-shadow(0 0 8px rgba(109,213,237,.4)) drop-shadow(0 0 16px rgba(109,213,237,.2));height:50px;margin-right:8px;-o-object-fit:contain;object-fit:contain;width:50px}.content{align-items:center;display:flex;flex:1;flex-direction:column;overflow-x:hidden;overflow-y:auto;padding:16px 16px 100px}.card{backdrop-filter:blur(16px);background:linear-gradient(180deg,rgba(15,21,32,.85),rgba(15,21,32,.9));border:1px solid var(--accent-border);border-radius:24px;box-shadow:inset 0 6px 20px rgba(0,0,0,.35),0 12px 28px rgba(0,0,0,.35);max-width:480px;padding:24px;width:100%}.section{margin-bottom:20px}.section:last-child{margin-bottom:0}.section-title{color:#a3b6ff;font-size:16px;font-weight:600;margin-bottom:8px}.balance-info{background:rgba(0,227,174,.1);border:1px solid rgba(0,227,174,.3);border-radius:12px;margin-bottom:16px;padding:12px;text-align:center}.balance-amount{color:var(--success);font-size:24px;font-weight:700;margin-bottom:4px}.balance-label{color:var(--muted);font-size:12px}.form-group{margin-bottom:16px}.form-label{color:var(--text);display:block;font-size:14px;font-weight:600;margin-bottom:6px}.form-input{background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.15);border-radius:12px;box-sizing:border-box;color:var(--text);font-size:16px;padding:12px 16px;width:100%}.form-input:focus{border-color:var(--brand);box-shadow:0 0 0 2px rgba(86,204,242,.2);outline:none}.form-input.error{border-color:var(--error);box-shadow:0 0 0 2px rgba(255,93,93,.2)}.error-message{color:var(--error);font-size:12px;margin-top:4px}.fee-info{background:hsla(0,0%,100%,.03);border-radius:8px;font-size:14px;padding:12px}.fee-row{display:flex;justify-content:space-between;margin-bottom:4px}.fee-row:last-child{border-top:1px solid hsla(0,0%,100%,.1);color:var(--brand);font-weight:600;margin-bottom:0;margin-top:8px;padding-top:8px}.quick-amounts{display:flex;gap:8px;margin-top:8px}.quick-amount{background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.15);border-radius:8px;color:var(--text);cursor:pointer;flex:1;font-size:12px;padding:8px 12px;text-align:center;transition:all .2s ease}.quick-amount:hover{background:rgba(86,204,242,.1);border-color:var(--brand)}.quiz-btn{background:linear-gradient(135deg,#ff6b35,#f7931e);border:none;border-radius:6px;box-shadow:0 2px 8px rgba(255,107,53,.3);color:#fff;cursor:pointer;display:inline-block;font-size:12px;font-weight:600;margin-left:8px;padding:4px 8px;text-decoration:none;transition:all .2s ease}.quiz-btn:hover{box-shadow:0 4px 12px rgba(255,107,53,.4);transform:translateY(-1px)}.bottom{backdrop-filter:blur(10px);background:hsla(0,0%,100%,.04);border-radius:20px 20px 0 0;border-top:1px solid hsla(0,0%,100%,.06);margin:0 12px 12px;padding:14px 16px calc(24px + var(--safe));z-index:100}.bottom,.modal-overlay{bottom:0;display:flex;left:0;position:fixed;right:0}.modal-overlay{align-items:center;backdrop-filter:blur(8px);background:rgba(0,0,0,.7);justify-content:center;padding:20px;top:0;z-index:1000}.modal-content{backdrop-filter:blur(16px);background:linear-gradient(180deg,rgba(15,21,32,.95),rgba(15,21,32,.98));border:1px solid var(--accent-border);border-radius:16px;box-shadow:0 20px 40px rgba(0,0,0,.5);max-height:80vh;max-width:400px;overflow-y:auto;width:100%}.modal-header{border-bottom:1px solid hsla(0,0%,100%,.1);padding:20px 20px 10px}.modal-header h3{color:var(--text);font-size:18px;font-weight:600;margin:0;text-align:center}.modal-body{padding:20px}.confirm-text{color:var(--text);font-size:16px;margin:0 0 15px;text-align:center}.address-display{align-items:center;background:hsla(0,0%,100%,.05);border:2px solid var(--accent-border);border-radius:12px;display:flex;justify-content:center;margin:15px 0;min-height:60px;padding:15px}.address-text{color:var(--text);font-family:Courier New,monospace;line-height:1.4;word-break:break-all}.address-text,.warning-text{font-size:14px;font-weight:500;text-align:center}.warning-text{color:var(--error);margin:15px 0 0}.hint-text{color:var(--muted);font-size:14px;line-height:1.4;margin:10px 0 0;text-align:center}.modal-footer{display:flex;gap:10px;justify-content:center;padding:10px 20px 20px}.modal-btn{border:none;border-radius:12px;cursor:pointer;flex:1;font-size:16px;font-weight:500;padding:12px 20px;transition:all .3s ease}.cancel-btn{background:hsla(0,0%,100%,.08);border:1px solid hsla(0,0%,100%,.15);color:var(--text)}.cancel-btn:hover{background:hsla(0,0%,100%,.12);transform:translateY(-1px)}.confirm-btn{background:linear-gradient(135deg,var(--brand),var(--brand-2));box-shadow:0 4px 12px rgba(47,128,237,.3);color:#fff}.confirm-btn:hover{box-shadow:0 6px 16px rgba(47,128,237,.4);transform:translateY(-1px)}@media (max-width:480px){.modal-overlay{padding:10px}.modal-content{max-height:90vh}.address-text{font-size:12px}.modal-btn{font-size:15px;padding:14px 16px}}.bottom button{background-image:linear-gradient(180deg,var(--brand),var(--brand-2));border:none;border-radius:16px;box-shadow:0 8px 24px rgba(47,128,237,.45),inset 0 1px 0 hsla(0,0%,100%,.25);color:var(--text);cursor:pointer;flex:1;font-size:14px;font-weight:800;margin:0 6px;padding:14px 0;transition:transform .08s ease,filter .2s ease,box-shadow .2s ease;white-space:nowrap}.bottom button:hover{filter:brightness(1.2);transform:translateY(-3px)}.bottom button:active{filter:brightness(.95);transform:translateY(0)}.bottom button:disabled{cursor:not-allowed;filter:none;opacity:.5;transform:none}.bottom .back-btn{background:hsla(0,0%,100%,.08);border:1px solid hsla(0,0%,100%,.15);border-radius:12px;color:var(--text);cursor:pointer;flex:1;font-size:16px;margin-right:12px;padding:12px 24px;position:static}.bottom .back-btn:hover{background:hsla(0,0%,100%,.12);transform:translateY(-2px)}</style>
  <link rel="stylesheet" crossorigin href="/newgold/assets/css/themes-Cd7cymCc.css">
  <link rel="stylesheet" crossorigin href="/newgold/assets/css/global-background-D97W4UkV.css">
</head>
<body>
  <script src="js/smart-back.js"></script>
  <div class="container">
    <div class="header">
      <img src="/newgold/assets/images/logo_gold7-BN-9ArRY.png" alt="Logo" class="logo-small" />
      <h1>提现</h1>
    </div>
    <div class="content">
      <div class="card">
        <div class="section">
          <div class="balance-info">
            <div class="balance-amount" id="currentBalance">-- USDT</div>
            <div class="balance-label">可提现余额</div>
          </div>
        </div>
        
        <div class="section">
          <div class="section-title">提现金额</div>
          <div class="form-group">
            <label class="form-label">金额 (USDT)</label>
            <input type="number" class="form-input" id="withdrawAmount" placeholder="最低20 USDT" min="20" step="0.01">
            <div class="error-message" id="amountError" style="display: none;"></div>
            <div class="quick-amounts">
              <button class="quick-amount" onclick="setQuickAmount(20)">20</button>
              <button class="quick-amount" onclick="setQuickAmount(50)">50</button>
              <button class="quick-amount" onclick="setQuickAmount(100)">100</button>
              <button class="quick-amount" onclick="setQuickAmount('all')">全部</button>
            </div>
          </div>
        </div>
        
        <div class="section">
          <div class="section-title">收款地址</div>
          <div class="form-group">
            <label class="form-label">USDT钱包地址</label>
            <input type="text" class="form-input" id="walletAddress" placeholder="请输入USDT钱包地址">
            <div class="error-message" id="addressError" style="display: none;"></div>
            <!-- 地址绑定状态显示 -->
            <div id="addressBindingStatus" style="display: none; margin-top: 8px; padding: 8px 12px; background: rgba(0, 227, 174, 0.1); border: 1px solid rgba(0, 227, 174, 0.3); border-radius: 8px; font-size: 12px;">
              <div style="color: var(--success); margin-bottom: 4px;">✓ 已绑定默认收款地址</div>
              <div style="color: var(--muted); word-break: break-all;" id="boundAddressDisplay"></div>
              <button type="button" id="changeAddressBtn" style="margin-top: 6px; padding: 4px 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; color: var(--text); font-size: 11px; cursor: pointer;">修改地址</button>
            </div>
          </div>
        </div>
        
        <div class="section">
          <div class="section-title">费用明细</div>
          <div class="fee-info">
            <div class="fee-row">
              <span>提现金额</span>
              <span id="feeAmount">0.00 USDT</span>
            </div>
            <div class="fee-row">
              <span>固定手续费</span>
              <span>2.00 USDT</span>
            </div>
            <div class="fee-row">
              <span id="feeRateLabel">比例手续费 (5%)</span>
              <span id="feePercent">0.00 USDT</span>
            </div>
            <div class="fee-row">
              <span>实际扣除</span>
              <span id="totalDeduct">0.00 USDT</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="bottom">
      <button class="back-btn" onclick="smartBackToParent()">返回</button>
      <button id="confirmBtn" onclick="confirmWithdraw()" disabled>确认提现</button>
    </div>
  </div>

  <!-- 自定义地址确认对话框 -->
  <div id="addressConfirmModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>确认收款地址</h3>
      </div>
      <div class="modal-body">
        <p class="confirm-text">请仔细核对您的收款地址：</p>
        <div class="address-display">
          <div id="confirmAddressText" class="address-text"></div>
        </div>
        <p class="warning-text">⚠️ 地址一旦确认将无法修改，请仔细核对！</p>
      </div>
      <div class="modal-footer">
        <button class="modal-btn cancel-btn" onclick="closeAddressConfirmModal()">取消</button>
        <button class="modal-btn confirm-btn" onclick="confirmAddress()">确认地址</button>
      </div>
    </div>
  </div>

  <!-- 绑定地址询问对话框 -->
  <div id="bindAddressModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>设置默认地址</h3>
      </div>
      <div class="modal-body">
        <p class="confirm-text">是否将此地址设为默认收款地址？</p>
        <p class="hint-text">设为默认后，下次提现将自动填入此地址，方便您快速操作。</p>
      </div>
      <div class="modal-footer">
        <button class="modal-btn cancel-btn" onclick="skipBinding()">暂不绑定</button>
        <button class="modal-btn confirm-btn" onclick="confirmBinding()">设为默认</button>
      </div>
    </div>
  </div>

  <script>
    let currentBalance = 0;
    let feeRate = 0.05;
    // 用户交互状态跟踪
    let userInteracted = {
      amount: false,
      address: false
    };
    
    function loadWithdrawPage() {
      // 从appState加载余额
      const appState = JSON.parse(localStorage.getItem('appState') || '{}');
      currentBalance = appState.walletBalance || 0;
      
      // 根据答题进度计算手续费率
      const correctCount = parseInt(localStorage.getItem('quizCorrect')) || 0;
      // 每答对1题降低0.2%，最低1%
      feeRate = Math.max(0.01, 0.05 - (correctCount * 0.002));
      
      document.getElementById('currentBalance').innerText = currentBalance.toFixed(2) + ' USDT';
      
      // 更新手续费标签和答题按钮
      updateFeeRateLabel();
      
      // 检查并加载绑定的地址
      loadBoundAddress();
      
      // 监听输入变化和用户交互
      const amountInput = document.getElementById('withdrawAmount');
      const addressInput = document.getElementById('walletAddress');
      
      // 金额输入框事件
      amountInput.addEventListener('input', function() {
        userInteracted.amount = true;
        updateFeeCalculation();
      });
      
      amountInput.addEventListener('blur', function() {
        userInteracted.amount = true;
        validateForm();
      });
      
      amountInput.addEventListener('focus', function() {
        if (!userInteracted.amount) {
          userInteracted.amount = true;
        }
      });
      
      // 地址输入框事件
      addressInput.addEventListener('input', function() {
        userInteracted.address = true;
        validateForm();
      });
      
      addressInput.addEventListener('blur', function() {
        userInteracted.address = true;
        validateForm();
      });
      
      addressInput.addEventListener('focus', function() {
        if (!userInteracted.address) {
          userInteracted.address = true;
        }
      });
      
      // 绑定地址相关事件
      document.getElementById('changeAddressBtn').addEventListener('click', enableAddressEdit);
      
      // 初始化时只计算费用，不显示验证错误
      updateFeeCalculationOnly();
    }
    
    function updateFeeRateLabel() {
      const feeRateLabel = document.getElementById('feeRateLabel');
      const feeRatePercent = (feeRate * 100).toFixed(1);
      const correctCount = parseInt(localStorage.getItem('quizCorrect') || '0');
      
      if (correctCount >= 20) {
        // 答对20题或以上：只显示比例手续费
        feeRateLabel.innerHTML = `比例手续费 (${feeRatePercent}%)`;
      } else {
        // 答对少于20题：显示比例手续费、答题进度和答题降费按钮
        const progressText = `已答对${correctCount}题`;
        const quizButton = `<a href="quiz.html" style="background: linear-gradient(135deg, #ff6b35, #f7931e); color: white; padding: 8px 16px; border-radius: 20px; text-decoration: none; font-size: 14px; margin-left: 10px;">答题降费</a>`;
        feeRateLabel.innerHTML = `比例手续费 (${feeRatePercent}%) - ${progressText} ${quizButton}`;
      }
    }
    
    function setQuickAmount(amount) {
      const amountInput = document.getElementById('withdrawAmount');
      if (amount === 'all') {
        // 计算最大可提现金额（扣除手续费后）
        const fixedFee = 2;
        // 使用更精确的计算方式，避免浮点数精度问题
        const maxAmount = Math.floor(((currentBalance - fixedFee) / (1 + feeRate)) * 100) / 100;
        amountInput.value = Math.max(0, maxAmount).toFixed(2);
      } else {
        amountInput.value = amount;
      }
      updateFeeCalculation();
    }
    
    function updateFeeCalculationOnly() {
      const amountInput = document.getElementById('withdrawAmount');
      const amount = parseFloat(amountInput.value) || 0;
      
      const fixedFee = 2;
      const percentFee = amount * feeRate;
      const totalFee = fixedFee + percentFee;
      const totalDeduct = amount + totalFee;
      
      document.getElementById('feeAmount').innerText = amount.toFixed(2) + ' USDT';
      document.getElementById('feePercent').innerText = percentFee.toFixed(2) + ' USDT';
      document.getElementById('totalDeduct').innerText = totalDeduct.toFixed(2) + ' USDT';
      
      // 只更新按钮状态，不显示错误信息
      updateButtonState();
    }
    
    function updateFeeCalculation() {
      const amountInput = document.getElementById('withdrawAmount');
      const amount = parseFloat(amountInput.value) || 0;
      
      const fixedFee = 2;
      const percentFee = amount * feeRate;
      const totalFee = fixedFee + percentFee;
      const totalDeduct = amount + totalFee;
      
      document.getElementById('feeAmount').innerText = amount.toFixed(2) + ' USDT';
      document.getElementById('feePercent').innerText = percentFee.toFixed(2) + ' USDT';
      document.getElementById('totalDeduct').innerText = totalDeduct.toFixed(2) + ' USDT';
      
      validateForm();
    }
    
    function updateButtonState() {
      const amountInput = document.getElementById('withdrawAmount');
      const addressInput = document.getElementById('walletAddress');
      const confirmBtn = document.getElementById('confirmBtn');
      
      const amount = parseFloat(amountInput.value) || 0;
      const address = addressInput.value.trim();
      const fixedFee = 2;
      const percentFee = amount * feeRate;
      const totalDeduct = amount + fixedFee + percentFee;
      
      // 检查基本条件但不显示错误信息
      const isAmountValid = amount >= 20 && totalDeduct <= currentBalance;
      const isAddressValid = address.length >= 10;
      
      confirmBtn.disabled = !(isAmountValid && isAddressValid);
    }
    
    function validateForm() {
      const amountInput = document.getElementById('withdrawAmount');
      const addressInput = document.getElementById('walletAddress');
      const confirmBtn = document.getElementById('confirmBtn');
      const amountError = document.getElementById('amountError');
      const addressError = document.getElementById('addressError');
      
      let isValid = true;
      
      // 验证金额 - 只在用户交互过后才显示错误
      const amount = parseFloat(amountInput.value) || 0;
      const fixedFee = 2;
      const percentFee = amount * feeRate;
      const totalDeduct = amount + fixedFee + percentFee;
      
      amountInput.classList.remove('error');
      amountError.style.display = 'none';
      
      if (userInteracted.amount) {
        if (amount < 20) {
          amountInput.classList.add('error');
          amountError.innerText = '提现金额不能少于20 USDT';
          amountError.style.display = 'block';
          isValid = false;
        } else if (totalDeduct > currentBalance) {
          amountInput.classList.add('error');
          amountError.innerText = `余额不足，需要${totalDeduct.toFixed(2)} USDT（含手续费）`;
          amountError.style.display = 'block';
          isValid = false;
        }
      } else {
        // 用户未交互时，仍然检查有效性但不显示错误
        if (amount < 20 || totalDeduct > currentBalance) {
          isValid = false;
        }
      }
      
      // 验证地址 - 只在用户交互过后才显示错误
      const address = addressInput.value.trim();
      addressInput.classList.remove('error');
      addressError.style.display = 'none';
      
      if (userInteracted.address) {
        if (address.length < 10) {
          addressInput.classList.add('error');
          addressError.innerText = '请输入有效的钱包地址';
          addressError.style.display = 'block';
          isValid = false;
        }
      } else {
        // 用户未交互时，仍然检查有效性但不显示错误
        if (address.length < 10) {
          isValid = false;
        }
      }
      
      confirmBtn.disabled = !isValid;
    }
    
    function confirmWithdraw() {
      const amount = parseFloat(document.getElementById('withdrawAmount').value);
      const address = document.getElementById('walletAddress').value.trim();
      
      // 检查是否需要地址确认和绑定
      const boundAddress = localStorage.getItem('boundWalletAddress');
      const isNewAddress = !boundAddress || boundAddress !== address;
      
      if (isNewAddress) {
        // 新地址需要二次确认
        showAddressConfirmation(address, amount, () => {
          proceedWithWithdraw(amount, address);
        });
      } else {
        // 使用已绑定地址，直接提现
        proceedWithWithdraw(amount, address);
      }
    }
    
    function showAddressConfirmation(address, amount, callback) {
      // 使用自定义对话框替代confirm
      const modal = document.getElementById('addressConfirmModal');
      const addressText = document.getElementById('confirmAddressText');
      
      // 设置地址文本
      addressText.textContent = address;
      
      // 显示对话框
      modal.style.display = 'flex';
      
      // 存储回调函数和地址信息
      window.currentAddressConfirm = {
        address: address,
        amount: amount,
        callback: callback
      };
    }

    function closeAddressConfirmModal() {
      const modal = document.getElementById('addressConfirmModal');
      modal.style.display = 'none';
      window.currentAddressConfirm = null;
    }

    function confirmAddress() {
      const modal = document.getElementById('addressConfirmModal');
      modal.style.display = 'none';
      
      if (window.currentAddressConfirm) {
        // 显示绑定询问对话框
        showBindAddressModal();
      }
    }

    function showBindAddressModal() {
      const modal = document.getElementById('bindAddressModal');
      modal.style.display = 'flex';
    }

    function skipBinding() {
      const modal = document.getElementById('bindAddressModal');
      modal.style.display = 'none';
      
      if (window.currentAddressConfirm) {
        window.currentAddressConfirm.callback();
        window.currentAddressConfirm = null;
      }
    }

    function confirmBinding() {
      const modal = document.getElementById('bindAddressModal');
      modal.style.display = 'none';
      
      if (window.currentAddressConfirm) {
        // 绑定地址
        localStorage.setItem('boundWalletAddress', window.currentAddressConfirm.address);
        // 刷新地址显示状态
        loadBoundAddress();
        
        // 执行回调
        window.currentAddressConfirm.callback();
        window.currentAddressConfirm = null;
      }
    }
    
    function proceedWithWithdraw(amount, address) {
      const fixedFee = 2;
      const percentFee = amount * feeRate;
      const totalFee = fixedFee + percentFee;
      const totalDeduct = amount + totalFee;
      
      // 最终确认
      const confirmed = confirm(`确认提现？\n\n提现金额：${amount.toFixed(2)} USDT\n手续费：${totalFee.toFixed(2)} USDT\n实际扣除：${totalDeduct.toFixed(2)} USDT\n提现地址：${address.substring(0, 10)}...\n\n预计24小时内到账`);
      
      if (!confirmed) return;
      
      // 执行提现
      const appState = JSON.parse(localStorage.getItem('appState') || '{}');
      const newBalance = currentBalance - totalDeduct;
      appState.walletBalance = newBalance;
      localStorage.setItem('appState', JSON.stringify(appState));
      
      // 生成交易ID
      const transactionId = 'tx_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      
      // 添加交易记录（初始状态为正在提现）
      let transactions = [];
      try {
        const stored = localStorage.getItem('transactions');
        if (stored) transactions = JSON.parse(stored);
      } catch (e) {}
      
      const transaction = {
        id: transactionId,
        type: 'withdraw',
        amount: -totalDeduct,
        description: `提现${amount.toFixed(2)} USDT`,
        timestamp: new Date().toISOString(),
        address: address,
        actualAmount: amount,
        fee: totalFee,
        status: 'processing',
        statusText: '正在提现'
      };
      
      transactions.push(transaction);
      localStorage.setItem('transactions', JSON.stringify(transactions));
      
      // 模拟提现流程状态变化
      setTimeout(() => {
        updateWithdrawStatus(transactionId, 'confirming', '等待链上确认');
      }, 3000); // 3秒后变为等待确认
      
      setTimeout(() => {
        updateWithdrawStatus(transactionId, 'completed', '提现成功');
      }, 15000); // 15秒后变为提现成功
      
      alert(`提现申请已提交！\n\n提现金额：${amount.toFixed(2)} USDT\n手续费：${totalFee.toFixed(2)} USDT\n剩余余额：${newBalance.toFixed(2)} USDT\n\n交易ID：${transactionId}`);
      
      // 返回钱包页面
      history.back();
    }
    
    function updateWithdrawStatus(transactionId, status, statusText) {
      let transactions = [];
      try {
        const stored = localStorage.getItem('transactions');
        if (stored) transactions = JSON.parse(stored);
      } catch (e) {}
      
      const transactionIndex = transactions.findIndex(tx => tx.id === transactionId);
      
      if (transactionIndex !== -1) {
        transactions[transactionIndex].status = status;
        transactions[transactionIndex].statusText = statusText;
        localStorage.setItem('transactions', JSON.stringify(transactions));
        
        // 如果当前在钱包页面，触发刷新
        if (window.location.pathname.includes('wallet.html')) {
          if (typeof loadTransactions === 'function') {
            loadTransactions();
          }
        }
      }
    }
    
    function loadBoundAddress() {
      const boundAddress = localStorage.getItem('boundWalletAddress');
      const addressInput = document.getElementById('walletAddress');
      const bindingStatus = document.getElementById('addressBindingStatus');
      const boundAddressDisplay = document.getElementById('boundAddressDisplay');
      
      if (boundAddress) {
        // 显示已绑定地址
        addressInput.value = boundAddress;
        addressInput.disabled = true;
        bindingStatus.style.display = 'block';
        boundAddressDisplay.textContent = boundAddress;
      } else {
        // 没有绑定地址
        bindingStatus.style.display = 'none';
        addressInput.disabled = false;
      }
      
      validateForm();
    }
    
    function enableAddressEdit() {
      const addressInput = document.getElementById('walletAddress');
      const bindingStatus = document.getElementById('addressBindingStatus');
      
      if (confirm('确定要修改收款地址吗？\n\n修改后需要重新确认新地址。')) {
        addressInput.disabled = false;
        addressInput.value = '';
        addressInput.focus();
        bindingStatus.style.display = 'none';
        validateForm();
      }
    }
    
    window.addEventListener('DOMContentLoaded', loadWithdrawPage);
  </script>
  <script src="js/global-background.js"></script>
</body>
</html>