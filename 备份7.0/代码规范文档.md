# H5 网页工程代码规范文档

## 📋 目录
1. [开发规范](#开发规范)
2. [代码质量标准](#代码质量标准)
3. [功能约束规则](#功能约束规则)
4. [项目结构规范](#项目结构规范)

---

## 🛠 开发规范

### 1. 项目结构规范

#### 1.1 模块接口设计
```javascript
// ✅ 推荐：使用 index.js 作为模块接口
// index.js
module.exports.SMSProvider = require("./SMSProvider");
module.exports.SMSNumberResolver = require("./SMSNumberResolver");

// ❌ 避免：直接引用子文件
// module.exports.SMSProvider = require("./SMSProvider/SMSProvider.js");
```

#### 1.2 配置管理
```json
{
  "Customer": {
    "dbConfig": {
      "host": "localhost",
      "port": 5984,
      "dbName": "customers"
    },
    "credit": {
      "initialLimit": 100,
      "initialDays": 1
    }
  }
}
```

#### 1.3 环境变量设置
```bash
# 启动前设置环境变量
$ NODE_ENV=development
$ node
```

### 2. Docker 部署规范

#### 2.1 多阶段构建
```dockerfile
FROM node:14.8.0-alpine AS build

COPY --chown=node:node package.json package-lock.json ./
# ✅ 安全安装
RUN npm ci
COPY --chown=node:node src ./src
RUN npm run build

# 运行时阶段
FROM node:14.8.0-alpine

COPY --chown=node:node --from=build package.json package-lock.json ./
COPY --chown=node:node --from=build node_modules ./node_modules
COPY --chown=node:node --from=build dist ./dist

# ✅ 清理开发依赖
RUN npm prune --production

CMD [ "node", "dist/app.js" ]
```

### 3. 测试规范

#### 3.1 测试标签化
```bash
# 使用 Mocha 运行特定标签的测试
mocha --grep 'sanity'
```

#### 3.2 独立测试数据
```javascript
it('When updating site name, get successful confirmation', async () => {
  // Arrange - 测试添加新记录并仅对该记录进行操作
  const siteUnderTest = await SiteService.addSite({
    name: 'siteForUpdateTest'
  });

  // Act
  const updateNameResult = await SiteService.changeName(siteUnderTest, 'newName');

  // Assert
  expect(updateNameResult).to.be(true);
});
```

---

## 📏 代码质量标准

### 1. 命名规范

#### 1.1 描述性命名
```javascript
// ❌ 不推荐
function q() {
  // ...
}

// ✅ 推荐
function query() {
  // ...
}
```

### 2. 格式化规范

#### 2.1 缩进规范
```javascript
// ❌ 不推荐
function foo() {
    let name;  // 4个空格
}

// ❌ 不推荐
function bar() {
 let name;     // 1个空格
}

// ✅ 推荐
function baz() {
  let name;    // 2个空格
}
```

#### 2.2 行长度限制
```javascript
// ❌ 不推荐：超过100字符
const foo = jsonData && jsonData.foo && jsonData.foo.bar && jsonData.foo.bar.baz && jsonData.foo.bar.baz.quux && jsonData.foo.bar.baz.quux.xyzzy;

// ✅ 推荐：使用可选链
const foo = jsonData
  ?.foo
  ?.bar
  ?.baz
  ?.quux
  ?.xyzzy;
```

#### 2.3 尾随逗号
```javascript
// ✅ 推荐
const hero = {
  firstName: 'Dana',
  lastName: 'Scully',
};

const heroes = [
  'Batman',
  'Superman',
];
```

### 3. 注释规范

#### 3.1 单行注释
```javascript
// ❌ 不推荐
const active = true;  // is current tab

// ✅ 推荐
// is current tab
const active = true;
```

#### 3.2 问题标注
```javascript
class Calculator extends Abacus {
  constructor() {
    super();

    // FIXME: shouldn't use a global here
    total = 0;
  }
}
```

### 4. 代码结构规范

#### 4.1 空行规范
```javascript
// ✅ 推荐：块后留空行
if (foo) {
  return bar;
}

return baz;
```

#### 4.2 避免重复成员
```javascript
// ❌ 不推荐
class Foo {
  bar() { return 1; }
  bar() { return 2; }  // 重复成员
}

// ✅ 推荐
class Foo {
  bar() { return 2; }
}
```

---

## 🎨 功能约束规则

### 1. 响应式设计约束

#### 1.1 媒体查询规范
```css
/* 移动优先设计 */
main {
  display: grid;
  grid-template-columns: 2fr 1fr;
}

@media (max-width: 45em) {
  main {
    display: block;
  }
}
```

#### 1.2 视口宽度约束
```css
/* 最小宽度约束 */
@media (min-width: 400px) {
  /* 宽于400像素的样式 */
}

/* 最大宽度约束 */
@media (max-width: 400px) {
  /* 窄于400像素的样式 */
}
```

### 2. 交互设计约束

#### 2.1 指针适配
```css
/* 粗指针设备（触摸屏）*/
@media (any-pointer: coarse) {
  button {
    padding: 1em 2em;
  }
}

/* 精细指针设备（鼠标）*/
@media (any-pointer: fine) {
  button {
    padding: 0.5em 1em;
  }
}
```

#### 2.2 动画约束
```css
/* 仅在快速更新且用户未禁用动画时应用 */
@media (update: fast) and (prefers-reduced-motion: no-preference) {
  a {
    transition-duration: 0.4s;
    transition-property: transform;
  }
  
  a:hover {
    transform: scale(150%);
  }
}
```

### 3. 显示模式约束

#### 3.1 独立应用模式
```css
button.back {
  display: none;
}

@media (display-mode: standalone) {
  button.back {
    display: inline;
  }
}
```

#### 3.2 颜色显示约束
```css
/* 彩色显示 */
@media (color) {
  body {
    color: maroon;
    background-color: linen;
  }
}

/* 单色显示 */
@media (monochrome) {
  body {
    color: black;
    background-color: white;
  }
}
```

### 4. 布局约束规范

#### 4.1 居中约束
```css
.wrapper {
  max-width: 400px;
  margin: 0 auto;  /* 水平居中 */
}
```

#### 4.2 内联块约束
```css
p span {
  display: inline-block;  /* 保持内联但支持边距和填充 */
}
```

---

## 📁 项目结构规范

### 1. 目录结构
```
project/
├── src/                    # 源代码目录
│   ├── components/         # 组件目录
│   ├── utils/             # 工具函数
│   ├── services/          # 服务层
│   └── index.js           # 入口文件
├── css/                   # 样式文件
├── i18n/                  # 国际化文件
├── backend/               # 后端代码
├── package.json           # 依赖配置
├── .eslintrc.cjs         # ESLint配置
├── .prettierrc           # Prettier配置
└── README.md             # 项目说明
```

### 2. 文件命名规范
- 使用小写字母和连字符：`user-service.js`
- 组件使用 PascalCase：`UserProfile.js`
- 常量使用 UPPER_CASE：`API_ENDPOINTS.js`

### 3. 导入导出规范
```javascript
// ✅ 推荐：命名导出
export const UserService = {
  // ...
};

// ✅ 推荐：默认导出
export default class UserModel {
  // ...
}
```

---

## 🔧 工具配置

### 1. ESLint 配置
```json
{
  "extends": ["airbnb-base"],
  "rules": {
    "indent": ["error", 2],
    "max-len": ["error", { "code": 100 }],
    "no-trailing-spaces": "error"
  }
}
```

### 2. Prettier 配置
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2
}
```

---

## ✅ 检查清单

### 开发前检查
- [ ] 项目结构符合规范
- [ ] 配置文件已正确设置
- [ ] 依赖版本已锁定

### 代码提交前检查
- [ ] ESLint 检查通过
- [ ] Prettier 格式化完成
- [ ] 测试用例通过
- [ ] 注释完整且准确

### 部署前检查
- [ ] Docker 构建成功
- [ ] 环境变量配置正确
- [ ] 生产依赖已优化

---

## 📚 参考资源

- [Node.js Best Practices](https://github.com/goldbergyoni/nodebestpractices)
- [Airbnb JavaScript Style Guide](https://github.com/airbnb/javascript)
- [HTML/CSS Learning Guide](https://hcdev.ru/learn)
- [MDN Web Docs](https://developer.mozilla.org/)

---

*最后更新：2024年12月*