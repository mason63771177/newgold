# 开发指导手册

## 🎯 目标
建立标准化的开发流程，彻底解决重复造轮子的问题，提高开发效率。

---

## 🔄 标准开发流程

### 第一步：需求分析 (必须)
```
1. 明确具体需求
2. 确定功能边界
3. 识别核心功能点
```

### 第二步：功能检索 (必须)
```
1. 搜索 `已实现功能清单.md`
2. 检查相关目录结构
3. 查看现有代码实现
```

### 第三步：决策判断
```
✅ 功能已存在 → 直接使用或扩展
⚠️ 部分存在 → 基于现有代码改进
❌ 完全不存在 → 新建功能
```

### 第四步：开发实施
```
1. 复用现有配置和工具
2. 遵循现有代码规范
3. 避免重复的依赖安装
```

### 第五步：文档更新 (必须)
```
1. 更新 `已实现功能清单.md`
2. 记录新功能的文件路径
3. 说明与现有功能的关系
```

---

## 📋 检索清单模板

### 开发前必查项目：
- [ ] 搜索 `已实现功能清单.md` 中的相关功能
- [ ] 检查 `/测试/` 目录下的现有测试
- [ ] 查看 `/backend/routes/` 中的API路由
- [ ] 确认 `package.json` 中的依赖包
- [ ] 检查配置文件 (playwright.config.js, jest.setup.js 等)

### 常见功能检索关键词：
- **测试相关**: `test`, `spec`, `playwright`, `jest`, `e2e`
- **用户功能**: `user`, `register`, `login`, `activation`
- **安全功能**: `security`, `xss`, `csrf`, `sql-injection`
- **API功能**: `routes`, `api`, `endpoint`
- **配置功能**: `config`, `setup`, `package.json`

---

## 🛠 工具和资源复用指南

### 测试工具复用
```javascript
// ✅ 正确：复用现有Playwright配置
import { test, expect } from '@playwright/test';
// 使用已配置的 playwright.config.js

// ❌ 错误：重新安装和配置Playwright
npm install @playwright/test  // 如果已存在则不需要
```

### API路由复用
```javascript
// ✅ 正确：扩展现有测试路由
// 在 backend/routes/testRoutes.js 中添加新的测试端点

// ❌ 错误：创建新的测试路由文件
// 创建 backend/routes/newTestRoutes.js
```

### 测试数据复用
```javascript
// ✅ 正确：使用现有的测试数据生成逻辑
const TEST_USER = {
  username: `testuser_${Date.now()}`,
  email: `test_${Date.now()}@example.com`,
  // ... 复用现有格式
};

// ❌ 错误：重新编写测试数据生成
```

---

## 📁 目录结构规范

### 新功能放置规则：
```
测试/
├── UI测试/           # Playwright E2E测试
├── 单元测试/         # Jest单元测试  
├── 集成测试/         # 系统集成测试
├── 安全测试/         # 安全相关测试
├── 性能测试/         # 性能基准测试
├── 回归测试/         # 回归验证测试
├── 测试脚本/         # 测试运行器和工具
└── 报告/            # 测试结果和报告
```

### 命名规范：
- **测试文件**: `功能名.test.js` 或 `功能名.spec.js`
- **配置文件**: `工具名.config.js`
- **工具脚本**: `run-功能名.js`
- **报告文件**: `功能名-report.md`

---

## 🚨 重复造轮子警告信号

### 危险信号：
- 🚨 重新安装已有的npm包
- 🚨 创建类似名称的测试文件
- 🚨 重写已有的配置文件
- 🚨 复制粘贴大段相似代码
- 🚨 重新实现已有的API端点

### 正确做法：
- ✅ 先搜索，后开发
- ✅ 扩展现有功能，而非重建
- ✅ 复用配置和工具
- ✅ 基于现有代码改进
- ✅ 及时更新功能清单

---

## 📝 代码复用模板

### Playwright测试模板：
```javascript
import { test, expect } from '@playwright/test';

// 复用现有的测试数据生成逻辑
const TEST_USER = {
  username: `testuser_${Date.now()}`,
  email: `test_${Date.now()}@example.com`,
  password: 'TestPassword123!',
  inviteCode: 'TEST123'
};

const API_BASE_URL = 'http://localhost:3000/api';

test.describe('新功能测试', () => {
  test.beforeEach(async ({ page }) => {
    // 复用现有的清理逻辑
    try {
      await fetch(`${API_BASE_URL}/test/reset-user/${TEST_USER.email}`, {
        method: 'DELETE'
      });
    } catch (error) {
      console.log('清理测试数据失败:', error.message);
    }
  });

  test('具体测试用例', async ({ page }) => {
    // 测试实现
  });
});
```

### API路由扩展模板：
```javascript
// 在现有的 testRoutes.js 中添加
router.get('/new-test-endpoint/:param', async (req, res) => {
  if (process.env.NODE_ENV === 'production') {
    return res.status(403).json({ error: '测试API仅在非生产环境可用' });
  }
  
  try {
    // 新的测试逻辑
    res.json({ success: true, data: result });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});
```

---

## 🔍 问题排查指南

### 当发现可能重复时：
1. **立即停止开发**
2. **搜索现有实现**
3. **分析差异和需求**
4. **决定复用或扩展方案**
5. **更新开发计划**

### 常见问题解决：
- **配置冲突**: 检查现有配置文件，避免重复配置
- **依赖冲突**: 查看package.json，复用现有依赖
- **功能重叠**: 分析现有功能，确定扩展点
- **测试重复**: 检查测试目录，避免重复测试逻辑

---

## 📊 效率提升指标

### 目标指标：
- 🎯 **重复代码率**: < 5%
- 🎯 **功能复用率**: > 80%
- 🎯 **开发时间节省**: > 50%
- 🎯 **代码维护成本**: 降低 > 60%

### 监控方法：
- 定期代码审查
- 功能清单更新频率
- 开发时间统计
- 代码质量分析

---

**⚠️ 核心原则：先搜索，后开发！**